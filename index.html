<!DOCTYPE html>
<footer class="text-center py-10">
        <a href="admin.html" class="text-gray-300 hover:text-pink-400 text-[10px] transition-colors">Administrace</a>
    </footer>
</body>
</html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mary Kay - Tv≈Øj d√°rkov√Ω poukaz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'mary-kay-katerina-v3';

        let userAuthenticated = false;
        let slots = [];
        let appointments = [];
        let unsubSlots = null;
        let unsubAppts = null;

        const tToM = (t) => {
            const [h, m] = t.split(':').map(Number);
            return h * 60 + m;
        };

        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) { console.error("Auth Error:", err); }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userAuthenticated = true;
                startSync();
            } else {
                userAuthenticated = false;
                if (unsubSlots) unsubSlots();
                if (unsubAppts) unsubAppts();
            }
        });

        initAuth();

        function startSync() {
            if (!auth.currentUser) return;
            const slotsRef = collection(db, 'artifacts', appId, 'public', 'data', 'slots');
            const apptsRef = collection(db, 'artifacts', appId, 'public', 'data', 'appointments');

            unsubSlots = onSnapshot(slotsRef, (s) => {
                slots = []; s.forEach(d => slots.push(d.data()));
                render();
            }, (err) => console.error(err));

            unsubAppts = onSnapshot(apptsRef, (s) => {
                appointments = []; s.forEach(d => appointments.push(d.data().appointment));
                render();
            }, (err) => console.error(err));
        }

        function render() {
            const select = document.getElementById('time-select');
            if (!select) return;

            const available = slots.filter(slot => {
                const label = `${new Date(slot.date).toLocaleDateString('cs-CZ')} v ${slot.time}`;
                if (appointments.includes(label)) return false;

                const isBlocked = appointments.some(apptLabel => {
                    const [aDate, aTime] = apptLabel.split(' v ');
                    if (aDate !== new Date(slot.date).toLocaleDateString('cs-CZ')) return false;
                    const diff = tToM(slot.time) - tToM(aTime);
                    return diff > 0 && diff <= 60;
                });
                return !isBlocked;
            });

            available.sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));

            select.innerHTML = '<option value="">Vyberte si term√≠n</option>';
            if (available.length === 0) {
                select.innerHTML = '<option value="">Moment√°lnƒõ nejsou voln√© ≈æ√°dn√© term√≠ny</option>';
            }

            available.forEach(s => {
                const text = `${new Date(s.date).toLocaleDateString('cs-CZ')} v ${s.time}`;
                const opt = document.createElement('option');
                opt.value = text; opt.innerText = text;
                select.appendChild(opt);
            });
        }

        window.openEnvelope = () => {
            document.getElementById('main-envelope').classList.add('open');
            setTimeout(() => {
                document.getElementById('envelope-stage').classList.add('hidden');
                document.getElementById('voucher-stage').classList.remove('hidden');
                document.getElementById('voucher-stage').classList.add('flex');
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#f1b2c3', '#e48da4'] });
            }, 800);
        };

        window.toggleFriend = (c) => {
            const f = document.getElementById('friend-fields');
            f.classList.toggle('hidden', !c);
            f.querySelectorAll('input').forEach(i => i.required = c);
        };

        window.handleBooking = async (e) => {
            e.preventDefault();
            if (!userAuthenticated) return;
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerText = "Odes√≠l√°m...";
            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'), phone: formData.get('phone'),
                email: formData.get('email'), appointment: formData.get('appointment'),
                note: formData.get('note'), withFriend: formData.get('with_friend') === 'on',
                friendName: formData.get('friend_name') || null,
                friendPhone: formData.get('friend_phone') || null,
                emailed: false, outcome: 'none', createdAt: serverTimestamp()
            };
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'appointments'), data);
                document.getElementById('booking-form-container').classList.add('hidden');
                document.getElementById('success-message').classList.remove('hidden');
                confetti({ particleCount: 150, spread: 100 });
            } catch (err) { alert("Chyba odesl√°n√≠."); btn.disabled = false; }
        };
    </script>

    <style>
        :root { --mk-pink: #f1b2c3; --mk-dark-pink: #e48da4; }
        body { font-family: 'Montserrat', sans-serif; background-color: #fdf2f4; }
        .playfair { font-family: 'Playfair Display', serif; }
        .envelope {
            position: relative; width: 280px; height: 180px; background: var(--mk-dark-pink);
            border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; margin: 0 auto;
            cursor: pointer; box-shadow: 0 15px 35px rgba(228, 141, 164, 0.3);
        }
        .envelope::before {
            content: ''; position: absolute; top: 0; left: 0; z-index: 2;
            border-left: 140px solid transparent; border-right: 140px solid transparent;
            border-top: 100px solid var(--mk-dark-pink); transform-origin: top; transition: 0.6s ease-in-out;
        }
        .envelope.open::before { transform: rotateX(180deg); z-index: 0; }
        .letter {
            position: absolute; bottom: 0; left: 10%; width: 80%; height: 80%; background: white;
            z-index: 1; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 20px;
        }
        .btn-gradient { background: linear-gradient(135deg, #e48da4 0%, #f1b2c3 100%); transition: 0.3s; }
        .form-input { border: 1px solid #eee; border-radius: 10px; padding: 12px; width: 100%; font-size: 0.9rem; }
        .form-input:focus { outline: none; border-color: var(--mk-dark-pink); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="envelope-stage" class="text-center w-full max-w-md">
        <h2 class="text-2xl mb-12 playfair italic text-gray-800 tracking-tight">D√°rkov√Ω poukaz Mary Kay</h2>
        <div class="envelope" id="main-envelope" onclick="openEnvelope()">
            <div class="letter shadow-inner">
                <div class="text-center">
                    <p class="text-[14px] uppercase tracking-[0.4em] text-pink-400 font-bold mt-4">Mary Kay</p>
                    <p class="text-[10px] text-gray-400 italic mt-1">Otev≈ôi mƒõ</p>
                </div>
            </div>
        </div>
        <p class="mt-8 text-gray-400 text-xs animate-pulse uppercase tracking-widest">Klikni pro otev≈ôen√≠</p>
    </div>

    <div id="voucher-stage" class="hidden w-full max-w-2xl bg-white/95 backdrop-blur-md rounded-3xl shadow-2xl overflow-hidden flex-col animate-in fade-in zoom-in duration-700 my-8">
        <div class="h-2 bg-gradient-to-r from-pink-300 via-pink-100 to-pink-300"></div>
        <div class="p-6 md:p-12">
            <div class="text-center mb-10">
                <span class="text-[10px] uppercase tracking-[0.5em] text-pink-400 font-bold mb-3 block">Exkluzivn√≠ Pozv√°n√≠</span>
                <h1 class="text-4xl md:text-5xl playfair font-bold text-gray-800 mb-2 leading-tight">D√°rkov√Ω poukaz</h1>
                <p class="text-gray-500 italic text-sm">Vƒõnuj ƒças sama sobƒõ a sv√© p√©ƒçi.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 py-8 border-y border-pink-50 mb-10">
                <div class="space-y-4 text-sm">
                    <h3 class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Co tƒõ ƒçek√°:</h3>
                    <ul class="space-y-2">
                        <li>‚ú® Bezplatn√° konzultace</li>
                        <li>üåø P√©ƒçe o ple≈• na m√≠ru</li>
                        <li>üíÑ Dekorativn√≠ kosmetika</li>
                        <li class="text-pink-600 font-bold">üéÅ D√°rek zdarma</li>
                    </ul>
                </div>
                <div class="bg-pink-50/40 p-6 rounded-2xl border border-pink-100/50 flex flex-col justify-between">
                    <div>
                        <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">M√≠sto:</p>
                        <p class="text-sm font-bold text-gray-800">Hotel Pal√°c, 1. m√°je 25, Olomouc</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=Hotel+Pal√°c+Olomouc+1.+m√°je+25" target="_blank" class="text-[10px] text-pink-500 underline mt-2 block font-bold uppercase">Zobrazit na mapƒõ üìç</a>
                    </div>
                    <div class="mt-4 pt-4 border-t border-pink-100">
                        <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Poradkynƒõ:</p>
                        <p class="playfair text-lg italic text-pink-600">Kate≈ôina Vychodilov√°</p>
                        <p class="text-xs text-gray-500">Tel: 776 164 298</p>
                    </div>
                </div>
            </div>

            <div id="booking-form-container">
                <form onsubmit="handleBooking(event)" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <input name="name" type="text" placeholder="Tv√© jm√©no" required class="form-input">
                        <input name="phone" type="tel" placeholder="Tv≈Øj telefon" required class="form-input">
                    </div>
                    <input name="email" type="email" placeholder="Tv≈Øj e-mail" required class="form-input">
                    <select id="time-select" name="appointment" required class="form-input">
                        <option value="">Naƒç√≠t√°m voln√© ƒçasy...</option>
                    </select>
                    <div class="p-4 bg-gray-50 rounded-2xl border border-gray-100">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="with_friend" onchange="toggleFriend(this.checked)" class="w-5 h-5 accent-pink-500">
                            <span class="text-sm font-semibold text-gray-700">P≈ôijdu s kamar√°dkou </span>
                        </label>
                        <div id="friend-fields" class="hidden mt-4 space-y-3">
                            <input name="friend_name" type="text" placeholder="Jm√©no kamar√°dky" class="form-input bg-white">
                            <input name="friend_phone" type="tel" placeholder="Telefon kamar√°dky" class="form-input bg-white">
                        </div>
                    </div>
                    <textarea name="note" placeholder="Prostor pro p≈ô√≠padn√© dotazy" rows="2" class="form-input"></textarea>
                    <button type="submit" class="w-full py-4 rounded-xl text-white font-bold uppercase tracking-widest text-xs btn-gradient shadow-lg">Potvrdit rezervaci</button>
                </form>
            </div>

            <div id="success-message" class="hidden text-center py-10 animate-bounce">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <h2 class="text-2xl playfair font-bold text-gray-800">Rezervov√°no!</h2>
                <p class="text-sm text-gray-600 italic">Dƒõkuji za z√°jem. Moc se na tebe tƒõ≈°√≠m!</p>
            </div>
        </div>
    </div>
</body>
</html>